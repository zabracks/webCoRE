var iosDragDropShim={holdToDrag:10,enableEnterLeave:true};(function(i){e=j;var l;function d(q){q=q||{};l=navigator.userAgent.match(/OS [1-4](?:_\d+)+ like Mac/)?"page":"client";var s=i.createElement("div");var r="draggable" in s;var o="ondragstart" in s&&"ondrop" in s;var p=!(r||o)||/iPad|iPhone|iPod|Android/.test(navigator.userAgent);e((p?"":"not ")+"patching html5 drag drop");if(!p){return}if(!q.enableEnterLeave){m.prototype.synthesizeEnterLeave=j}if(q.holdToDrag){i.addEventListener("touchstart",c(q.holdToDrag))}else{i.addEventListener("touchstart",f)}}function m(p,o){this.dragData={};this.dragDataTypes=[];this.dragImage=null;this.dragImageTransform=null;this.dragImageWebKitTransform=null;this.customDragImage=null;this.customDragImageX=null;this.customDragImageY=null;this.el=o||p.target;e("dragstart");if(this.dispatchDragStart()){this.createDragImage();this.listen()}}m.prototype={listen:function(){var p=g(i,"touchmove",this.move,this);var o=g(i,"touchend",q,this);var s=g(i,"touchcancel",r,this);function q(t){this.dragend(t,t.target);r.call(this)}function r(){e("cleanup");this.dragDataTypes=[];if(this.dragImage!==null){this.dragImage.parentNode.removeChild(this.dragImage);this.dragImage=null;this.dragImageTransform=null;this.dragImageWebKitTransform=null}this.customDragImage=null;this.customDragImageX=null;this.customDragImageY=null;this.el=this.dragData=null;return[p,o,s].forEach(function(t){return t.off()})}},move:function(q){q.preventDefault();var p=[],r=[];[].forEach.call(q.changedTouches,function(t){p.push(t.pageX);r.push(t.pageY)});var o=a(p)-(this.customDragImageX||parseInt(this.dragImage.offsetWidth,10)/2);var s=a(r)-(this.customDragImageY||parseInt(this.dragImage.offsetHeight,10)/2);this.translateDragImage(o,s);this.synthesizeEnterLeave(q)},translateDragImage:function(o,q){var p="translate("+o+"px,"+q+"px) ";if(this.dragImageWebKitTransform!==null){this.dragImage.style["-webkit-transform"]=p+this.dragImageWebKitTransform}if(this.dragImageTransform!==null){this.dragImage.style.transform=p+this.dragImageTransform}},synthesizeEnterLeave:function(o){var p=h(this.el,o);if(p!=this.lastEnter){if(this.lastEnter){this.dispatchLeave(o)}this.lastEnter=p;if(this.lastEnter){this.dispatchEnter(o)}}if(this.lastEnter){this.dispatchOver(o)}},dragend:function(o){e("dragend");if(this.lastEnter){this.dispatchLeave(o)}var p=h(this.el,o);if(p){e("found drop target "+p.tagName);this.dispatchDrop(p,o)}else{e("no drop target")}var q=i.createEvent("Event");q.initEvent("dragend",true,true);this.el.dispatchEvent(q)},dispatchDrop:function(r,q){var p=i.createEvent("Event");p.initEvent("drop",true,true);var u=q.changedTouches[0];var o=u[l+"X"];var t=u[l+"Y"];var s=k(r);p.offsetX=o-s.x;p.offsetY=t-s.y;p.dataTransfer={types:this.dragDataTypes,getData:function(v){return this.dragData[v]}.bind(this),dropEffect:"move"};p.preventDefault=function(){}.bind(this);b(i,"drop",function(){e("drop event not canceled")},this);r.dispatchEvent(p)},dispatchEnter:function(p){var o=i.createEvent("Event");o.initEvent("dragenter",true,true);o.dataTransfer={types:this.dragDataTypes,getData:function(r){return this.dragData[r]}.bind(this)};var q=p.changedTouches[0];o.pageX=q.pageX;o.pageY=q.pageY;o.clientX=q.clientX;o.clientY=q.clientY;this.lastEnter.dispatchEvent(o)},dispatchOver:function(o){var p=i.createEvent("Event");p.initEvent("dragover",true,true);p.dataTransfer={types:this.dragDataTypes,getData:function(r){return this.dragData[r]}.bind(this)};var q=o.changedTouches[0];p.pageX=q.pageX;p.pageY=q.pageY;p.clientX=q.clientX;p.clientY=q.clientY;this.lastEnter.dispatchEvent(p)},dispatchLeave:function(p){var o=i.createEvent("Event");o.initEvent("dragleave",true,true);o.dataTransfer={types:this.dragDataTypes,getData:function(r){return this.dragData[r]}.bind(this)};var q=p.changedTouches[0];o.pageX=q.pageX;o.pageY=q.pageY;o.clientX=q.clientX;o.clientY=q.clientY;this.lastEnter.dispatchEvent(o);this.lastEnter=null},dispatchDragStart:function(){var o=i.createEvent("Event");o.initEvent("dragstart",true,true);o.dataTransfer={setData:function(p,q){this.dragData[p]=q;if(this.dragDataTypes.indexOf(p)==-1){this.dragDataTypes[this.dragDataTypes.length]=p}return q}.bind(this),setDragImage:function(q,p,r){this.customDragImage=q;this.customDragImageX=p;this.customDragImageY=r}.bind(this),dropEffect:"move"};return this.el.dispatchEvent(o)},createDragImage:function(){if(this.customDragImage){this.dragImage=this.customDragImage.cloneNode(true);n(this.customDragImage,this.dragImage)}else{this.dragImage=this.el.cloneNode(true);n(this.el,this.dragImage)}this.dragImage.style.opacity="0.5";this.dragImage.style.position="absolute";this.dragImage.style.left="0px";this.dragImage.style.top="0px";this.dragImage.style.zIndex="999999";var o=this.dragImage.style.transform;if(typeof o!=="undefined"){this.dragImageTransform="";if(o!="none"){this.dragImageTransform=o.replace(/translate\(\D*\d+[^,]*,\D*\d+[^,]*\)\s*/g,"")}}var p=this.dragImage.style["-webkit-transform"];if(typeof p!=="undefined"){this.dragImageWebKitTransform="";if(p!="none"){this.dragImageWebKitTransform=p.replace(/translate\(\D*\d+[^,]*,\D*\d+[^,]*\)\s*/g,"")}}this.translateDragImage(-9999,-9999);i.body.appendChild(this.dragImage)}};function c(o){return function(r){var s=r.target;if(s.draggable===true){var u=function(){q.off();t.off();p.off();f(r)};var v=function(){q.off();t.off();p.off();clearTimeout(w)};var w=setTimeout(u,o);var q=g(s,"touchend",v,this);var t=g(s,"touchcancel",v,this);var p=g(window,"scroll",v,this)}}}function f(o){var p=o.target;do{if(p.draggable===true){if(!p.hasAttribute("draggable")&&p.tagName.toLowerCase()=="a"){var q=document.createEvent("MouseEvents");q.initMouseEvent("click",true,true,p.ownerDocument.defaultView,1,o.screenX,o.screenY,o.clientX,o.clientY,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,0,null);p.dispatchEvent(q);e("Simulating click to anchor")}o.preventDefault();new m(o,p);break}}while((p=p.parentNode)&&p!==i.body)}function h(o,p){var r=p.changedTouches[0];var q=i.elementFromPoint(r[l+"X"],r[l+"Y"]);return q}function k(o){var p=o.getBoundingClientRect();return{x:p.left,y:p.top}}function g(q,r,p,o){if(o){p=p.bind(o)}q.addEventListener(r,p);return{off:function(){return q.removeEventListener(r,p)}}}function b(q,r,p,o){if(o){p=p.bind(o)}function s(t){p(t);return q.removeEventListener(r,s)}return q.addEventListener(r,s)}function n(r,t){if(r.nodeType==1){t.removeAttribute("id");t.removeAttribute("class");t.removeAttribute("style");t.removeAttribute("draggable");var q=window.getComputedStyle(r);for(var p=0;p<q.length;p++){var s=q[p];t.style.setProperty(s,q.getPropertyValue(s),q.getPropertyPriority(s))}t.style.pointerEvents="none"}if(r.hasChildNodes()){for(var o=0;o<r.childNodes.length;o++){n(r.childNodes[o],t.childNodes[o])}}}function e(o){console.log(o)}function a(o){if(o.length===0){return 0}return o.reduce((function(q,p){return p+q}),0)/o.length}function j(){}d(window.iosDragDropShim)})(document);
