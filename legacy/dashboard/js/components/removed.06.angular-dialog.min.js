!function(e,a){"undefined"!=typeof module&&module.exports?"undefined"==typeof angular?(a(require("angular")),module.exports="ngDialog"):(a(angular),module.exports="ngDialog"):"function"==typeof define&&define.amd?define(["angular"],a):a(e.angular)}(this,function(e){"use strict";var a=e.module("ngDialog",[]),o=e.element,n=e.isDefined,l=(document.body||document.documentElement).style,t=n(l.animation)||n(l.WebkitAnimation)||n(l.MozAnimation)||n(l.MsAnimation)||n(l.OAnimation),i="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",r="a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]",s="ngdialog-disabled-animation",c={html:!1,body:!1},d={},u=[],g=!1;return a.provider("ngDialog",function(){var a=this.defaults={className:"ngdialog-theme-default",disableAnimation:!1,plain:!1,showClose:!0,closeByDocument:!0,closeByEscape:!0,closeByNavigation:!1,appendTo:!1,preCloseCallback:!1,overlay:!0,cache:!0,trapFocus:!0,preserveFocus:!0,ariaAuto:!0,ariaRole:null,ariaLabelledById:null,ariaLabelledBySelector:null,ariaDescribedById:null,ariaDescribedBySelector:null};this.setForceHtmlReload=function(e){c.html=e||!1},this.setForceBodyReload=function(e){c.body=e||!1},this.setDefaults=function(o){e.extend(a,o)};var f,n=0,l=0,p={};this.$get=["$document","$templateCache","$compile","$q","$http","$rootScope","$timeout","$window","$controller","$injector",function(v,m,y,b,D,h,C,$,A,E){var B=[],S={onDocumentKeydown:function(e){27===e.keyCode&&k.close("$escape")},activate:function(e){var a=e.data("$ngDialogOptions");a.trapFocus&&(e.on("keydown",S.onTrapFocusKeydown),B.body.on("keydown",S.onTrapFocusKeydown))},deactivate:function(e){e.off("keydown",S.onTrapFocusKeydown),B.body.off("keydown",S.onTrapFocusKeydown)},deactivateAll:function(a){e.forEach(a,function(a){var o=e.element(a);S.deactivate(o)})},setBodyPadding:function(e){var a=parseInt(B.body.css("padding-right")||0,10);B.body.css("padding-right",a+e+"px"),B.body.data("ng-dialog-original-padding",a),h.$broadcast("ngDialog.setPadding",e)},resetBodyPadding:function(){var e=B.body.data("ng-dialog-original-padding");e?B.body.css("padding-right",e+"px"):B.body.css("padding-right",""),h.$broadcast("ngDialog.setPadding",0)},performCloseDialog:function(e,a){var o=e.data("$ngDialogOptions"),n=e.attr("id"),r=d[n];if(r){if("undefined"!=typeof $.Hammer){var s=r.hammerTime;s.off("tap",f),s.destroy&&s.destroy(),delete r.hammerTime}else e.unbind("click");1===l&&B.body.unbind("keydown",S.onDocumentKeydown),e.hasClass("ngdialog-closing")||(l-=1);var c=e.data("$ngDialogPreviousFocus");c&&c.focus&&c.focus(),h.$broadcast("ngDialog.closing",e,a),l=0>l?0:l,t&&!o.disableAnimation?(r.$destroy(),e.unbind(i).bind(i,function(){S.closeDialogElement(e,a)}).addClass("ngdialog-closing")):(r.$destroy(),S.closeDialogElement(e,a)),p[n]&&(p[n].resolve({id:n,value:a,$dialog:e,remainingDialogs:l}),delete p[n]),d[n]&&delete d[n],u.splice(u.indexOf(n),1),u.length||(B.body.unbind("keydown",S.onDocumentKeydown),g=!1)}},closeDialogElement:function(e,a){e.remove(),0===l&&(B.html.removeClass("ngdialog-open"),B.body.removeClass("ngdialog-open"),S.resetBodyPadding()),h.$broadcast("ngDialog.closed",e,a)},closeDialog:function(a,o){var n=a.data("$ngDialogPreCloseCallback");if(n&&e.isFunction(n)){var l=n.call(a,o);e.isObject(l)?l.closePromise?l.closePromise.then(function(){S.performCloseDialog(a,o)}):l.then(function(){S.performCloseDialog(a,o)},function(){}):l!==!1&&S.performCloseDialog(a,o)}else S.performCloseDialog(a,o)},onTrapFocusKeydown:function(a){var n,o=e.element(a.currentTarget);if(o.hasClass("ngdialog"))n=o;else if(n=S.getActiveDialog(),null===n)return;var l=9===a.keyCode,t=a.shiftKey===!0;l&&S.handleTab(n,a,t)},handleTab:function(e,a,o){var n=S.getFocusableElements(e);if(0===n.length)return void(document.activeElement&&document.activeElement.blur());var l=document.activeElement,t=Array.prototype.indexOf.call(n,l),i=-1===t,r=0===t,s=t===n.length-1,c=!1;o?(i||r)&&(n[n.length-1].focus(),c=!0):(i||s)&&(n[0].focus(),c=!0),c&&(a.preventDefault(),a.stopPropagation())},autoFocus:function(e){var a=e[0],n=a.querySelector("*[autofocus]");if(null===n||(n.focus(),document.activeElement!==n)){var l=S.getFocusableElements(e);if(l.length>0)return void l[0].focus();var t=S.filterVisibleElements(a.querySelectorAll("h1,h2,h3,h4,h5,h6,p,span"));if(t.length>0){var i=t[0];o(i).attr("tabindex","-1").css("outline","0"),i.focus()}}},getFocusableElements:function(e){var a=e[0],o=a.querySelectorAll(r),n=S.filterTabbableElements(o);return S.filterVisibleElements(n)},filterTabbableElements:function(e){for(var a=[],n=0;n<e.length;n++){var l=e[n];"-1"!==o(l).attr("tabindex")&&a.push(l)}return a},filterVisibleElements:function(e){for(var a=[],o=0;o<e.length;o++){var n=e[o];(n.offsetWidth>0||n.offsetHeight>0)&&a.push(n)}return a},getActiveDialog:function(){var e=document.querySelectorAll(".ngdialog");return 0===e.length?null:o(e[e.length-1])},applyAriaAttributes:function(e,a){if(a.ariaAuto){if(!a.ariaRole){var o=S.getFocusableElements(e).length>0?"dialog":"alertdialog";a.ariaRole=o}a.ariaLabelledBySelector||(a.ariaLabelledBySelector="h1,h2,h3,h4,h5,h6"),a.ariaDescribedBySelector||(a.ariaDescribedBySelector="article,section,p")}a.ariaRole&&e.attr("role",a.ariaRole),S.applyAriaAttribute(e,"aria-labelledby",a.ariaLabelledById,a.ariaLabelledBySelector),S.applyAriaAttribute(e,"aria-describedby",a.ariaDescribedById,a.ariaDescribedBySelector)},applyAriaAttribute:function(e,a,n,l){if(n&&e.attr(a,n),l){var t=e.attr("id"),i=e[0].querySelector(l);if(!i)return;var r=t+"-"+a;return o(i).attr("id",r),e.attr(a,r),r}},detectUIRouter:function(){try{return e.module("ui.router"),!0}catch(a){return!1}},getRouterLocationEventName:function(){return S.detectUIRouter()?"$stateChangeSuccess":"$locationChangeSuccess"}},k={__PRIVATE__:S,open:function(t){function x(e,a){return h.$broadcast("ngDialog.templateLoading",e),D.get(e,a||{}).then(function(a){return h.$broadcast("ngDialog.templateLoaded",e),a.data||""})}function I(a){return a?e.isString(a)&&i.plain?a:"boolean"!=typeof i.cache||i.cache?x(a,{cache:m}):x(a,{cache:!1}):"Empty template"}var i=e.copy(a),r=++n,c="ngdialog"+r;u.push(c),t=t||{},e.extend(i,t);var v;p[c]=v=b.defer();var w;d[c]=w=e.isObject(i.scope)?i.scope.$new():h.$new();var F,T,P=e.extend({},i.resolve);return e.forEach(P,function(a,o){P[o]=e.isString(a)?E.get(a):E.invoke(a,null,null,o)}),b.all({template:I(i.template||i.templateUrl),locals:b.all(P)}).then(function(a){var n=a.template,t=a.locals;i.showClose&&(n+='<div class="ngdialog-close"></div>');var d=i.overlay?"":" ngdialog-no-overlay";if(F=o('<div id="ngdialog'+r+'" class="ngdialog'+d+'"></div>'),F.html(i.overlay?'<div class="ngdialog-overlay"></div><div class="ngdialog-content" role="document">'+n+"</div>":'<div class="ngdialog-content" role="document">'+n+"</div>"),F.data("$ngDialogOptions",i),w.ngDialogId=c,i.data&&e.isString(i.data)){var u=i.data.replace(/^\s*/,"")[0];w.ngDialogData="{"===u||"["===u?e.fromJson(i.data):i.data,w.ngDialogData.ngDialogId=c}else i.data&&e.isObject(i.data)&&(w.ngDialogData=i.data,w.ngDialogData.ngDialogId=c);if(i.className&&F.addClass(i.className),i.disableAnimation&&F.addClass(s),T=i.appendTo&&e.isString(i.appendTo)?e.element(document.querySelector(i.appendTo)):B.body,S.applyAriaAttributes(F,i),i.preCloseCallback){var p;e.isFunction(i.preCloseCallback)?p=i.preCloseCallback:e.isString(i.preCloseCallback)&&w&&(e.isFunction(w[i.preCloseCallback])?p=w[i.preCloseCallback]:w.$parent&&e.isFunction(w.$parent[i.preCloseCallback])?p=w.$parent[i.preCloseCallback]:h&&e.isFunction(h[i.preCloseCallback])&&(p=h[i.preCloseCallback])),p&&F.data("$ngDialogPreCloseCallback",p)}if(w.closeThisDialog=function(e){S.closeDialog(F,e)},i.controller&&(e.isString(i.controller)||e.isArray(i.controller)||e.isFunction(i.controller))){var v;i.controllerAs&&e.isString(i.controllerAs)&&(v=i.controllerAs);var m=A(i.controller,e.extend(t,{$scope:w,$element:F}),null,v);F.data("$ngDialogControllerController",m)}if(C(function(){var e=document.querySelectorAll(".ngdialog");S.deactivateAll(e),y(F)(w);var a=$.innerWidth-B.body.prop("clientWidth");B.html.addClass("ngdialog-open"),B.body.addClass("ngdialog-open");var o=a-($.innerWidth-B.body.prop("clientWidth"));o>0&&S.setBodyPadding(o),T.append(F),S.activate(F),i.trapFocus&&S.autoFocus(F),i.name?h.$broadcast("ngDialog.opened",{dialog:F,name:i.name}):h.$broadcast("ngDialog.opened",F)}),g||(B.body.bind("keydown",S.onDocumentKeydown),g=!0),i.closeByNavigation){var b=S.getRouterLocationEventName();h.$on(b,function(){S.closeDialog(F)})}if(i.preserveFocus&&F.data("$ngDialogPreviousFocus",document.activeElement),f=function(e){var a=i.closeByDocument?o(e.target).hasClass("ngdialog-overlay"):!1,n=o(e.target).hasClass("ngdialog-close");(a||n)&&k.close(F.attr("id"),n?"$closeButton":"$document")},"undefined"!=typeof $.Hammer){var D=w.hammerTime=$.Hammer(F[0]);D.on("tap",f)}else F.bind("click",f);return l+=1,k}),{id:c,closePromise:v.promise,close:function(e){S.closeDialog(F,e)}}},openConfirm:function(a){var n=b.defer(),l={closeByEscape:!1,closeByDocument:!1};e.extend(l,a),l.scope=e.isObject(l.scope)?l.scope.$new():h.$new(),l.scope.confirm=function(e){n.resolve(e);var a=o(document.getElementById(t.id));S.performCloseDialog(a,e)};var t=k.open(l);return t.closePromise.then(function(e){return e?n.reject(e.value):n.reject()}),n.promise},isOpen:function(e){var a=o(document.getElementById(e));return a.length>0},close:function(e,a){var n=o(document.getElementById(e));if(n.length)S.closeDialog(n,a);else if("$escape"===e){var l=u[u.length-1];n=o(document.getElementById(l)),n.data("$ngDialogOptions").closeByEscape&&S.closeDialog(n,"$escape")}else k.closeAll(a);return k},closeAll:function(e){for(var a=document.querySelectorAll(".ngdialog"),n=a.length-1;n>=0;n--){var l=a[n];S.closeDialog(o(l),e)}},getOpenDialogs:function(){return u},getDefaults:function(){return a}};return e.forEach(["html","body"],function(e){if(B[e]=v.find(e),c[e]){var a=S.getRouterLocationEventName();h.$on(a,function(){B[e]=v.find(e)})}}),k}]}),a.directive("ngDialog",["ngDialog",function(a){return{restrict:"A",scope:{ngDialogScope:"="},link:function(o,n,l){n.on("click",function(n){n.preventDefault();var t=e.isDefined(o.ngDialogScope)?o.ngDialogScope:"noScope";e.isDefined(l.ngDialogClosePrevious)&&a.close(l.ngDialogClosePrevious);var i=a.getDefaults();a.open({template:l.ngDialog,className:l.ngDialogClass||i.className,controller:l.ngDialogController,controllerAs:l.ngDialogControllerAs,bindToController:l.ngDialogBindToController,scope:t,data:l.ngDialogData,showClose:"false"===l.ngDialogShowClose?!1:"true"===l.ngDialogShowClose?!0:i.showClose,closeByDocument:"false"===l.ngDialogCloseByDocument?!1:"true"===l.ngDialogCloseByDocument?!0:i.closeByDocument,closeByEscape:"false"===l.ngDialogCloseByEscape?!1:"true"===l.ngDialogCloseByEscape?!0:i.closeByEscape,overlay:"false"===l.ngDialogOverlay?!1:"true"===l.ngDialogOverlay?!0:i.overlay,preCloseCallback:l.ngDialogPreCloseCallback||i.preCloseCallback})})}}}]),a});
